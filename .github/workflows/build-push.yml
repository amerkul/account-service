name: Publish Docker Image

on:
  push:
    branches: [istio-k8s]

jobs:
  deployment:

    runs-on: self-hosted
    permissions:
      contents: read
      packages: write

    steps:
    - uses: actions/checkout@v3  
    - name: Deploy to minikube
      run: |
          set -ex
          cd $HOME
          wget https://dl.k8s.io/release/v1.26.0/bin/linux/arm64/kubectl
          chmod +x ./kubectl
          ./kubectl auth can-i get pods
          ./kubectl get pods -A
